<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Video Reach Tracker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: #f8f9fc;
      margin: 0;
      padding: 0;
      text-align: center;
      color: #222;
      overflow-x: hidden;
    }

    header {
      background: linear-gradient(120deg, #007bff, #00c6ff);
      color: white;
      padding: 40px 20px 60px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      opacity: 0;
      animation: fadeInDown 1s forwards;
    }

    #topLogo {
      height: 50%;
      width: auto;
      position: absolute;
      top: 50%;
      right: 30px;
      transform: translateY(-50%);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      background: rgba(255,255,255,0.1);
      padding: 5px;
      object-fit: contain;
    }

    h1 {
      margin: 0;
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    #subText {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-top: 10px;
    }

    #counters {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      display: inline-block;
      margin-top: -30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      opacity: 0;
    }

    #mainContent {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      flex-wrap: wrap;
      margin: 40px auto;
      width: 90%;
    }

    #map, #videoContainer {
      width: 48%;
      min-width: 300px;
      height: 70vh;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    }

    iframe {
      width: 100%;
      height: 100%;
      border-radius: 15px;
      border: none;
    }

    #schoolName {
      font-size: 1.2rem;
      color: #333;
      margin-bottom: 30px;
      opacity: 0;
    }

    /* Charts + info layout */
    #chartsContainer {
      display: flex;
      justify-content: flex-start;
      gap: 20px;
      flex-wrap: wrap;
      margin: 30px auto 60px;
      width: 90%;
    }

    .chart-box {
      width: 45%;
      height: 260px;
      background: #fff;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.3s ease;
    }
    .chart-box:hover { transform: translateY(-5px); }

    .info-card {
      width: 45%;
      height: 260px;
      background: linear-gradient(135deg, #f8f9fc, #e0f7ff);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      font-size: 1rem;
      color: #333;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      transition: transform 0.3s ease;
    }
    .info-card:hover { transform: translateY(-5px); }

    #barChartContainer {
      width: 90%;
      margin: 0 auto 60px;
    }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDRh15d9pIjXkDANjAfSIJBC6bMOy44ZWI"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>üåç Live Data Tracking for Video Reach</h1>
    <img src="assests/logo.jpg" id="topLogo" alt="Logo">
    <div id="subText">Tracking real-time impact of the video across izations</div>
  </header>

  <div id="counters">Organizations: 0 | Viewers: 0</div>

  <div id="mainContent">
    <div id="videoContainer">
      <iframe src="https://www.youtube.com/embed/JvEGXiQcYPI" allowfullscreen></iframe>
    </div>
    <div id="map"></div>
  </div>

  <div id="schoolName">Hover over a pin to see the ization name</div>

  <!-- Pie + Info Card -->
  <div id="chartsContainer">
    <div class="chart-box">
      <canvas id="orgPieChart"></canvas>
    </div>
    <div class="info-card">
      <div>Click to access the Google Form:</div>
      <a href="https://forms.gle/Vt81efP2fELoPS5H7" target="_blank">Open Form</a>
      <div style="margin-top:20px;">Email: xyz@gmail.com</div>
    </div>
  </div>

  <!-- Bar Graph Below -->
  <div id="barChartContainer">
    <div class="chart-box">
      <canvas id="viewBarChart"></canvas>
    </div>
  </div>

  <script>
    async function initMap() {
      const response = await fetch("https://script.google.com/macros/s/AKfycbzJJIagM6mqa-6wSObRiYWTFlN4i_Jt1lQgNIlyBrsVzPyLAr9tGVmJuBAFCgc-kAx-wQ/exec");
      const data = await response.json();

      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 4,
        center: { lat: 23.5, lng: 80 },
        minZoom: 2,
        maxZoom: 10,
        styles: [
          { featureType: "poi", stylers: [{ visibility: "off" }] },
          { featureType: "road", stylers: [{ visibility: "simplified" }] },
        ]
      });

      document.getElementById("counters").style.animation = "fadeInUp 1s forwards";
      document.getElementById("map").style.animation = "fadeInUp 1.2s forwards";
      document.getElementById("schoolName").style.animation = "fadeInUp 1.4s forwards";

      const totalOrganizations = data.length;
      let totalViewers = 0;
      data.forEach(row => {
        const viewers = parseInt(row["Number of individuals who watched the video"]) || 0;
        totalViewers += viewers;
      });

      const countersEl = document.getElementById("counters");
      let displayOrgs = 0;
      let displayViewers = 0;
      const steps = 60;
      let frame = 0;
      const counterAnim = setInterval(() => {
        frame++;
        displayOrgs = Math.floor((totalOrganizations / steps) * frame);
        displayViewers = Math.floor((totalViewers / steps) * frame);
        countersEl.textContent = `üè¢ Schools: ${displayOrgs} | üëÅÔ∏è Students: ${displayViewers}`;
        if (frame >= steps) {
          countersEl.textContent = `üè¢ Schools: ${totalOrganizations} | üëÅÔ∏è Students: ${totalViewers}`;
          clearInterval(counterAnim);
        }
      }, 25);

      // Map markers
      data.forEach(row => {
        const lat = parseFloat(row["lat"]);
        const lng = parseFloat(row["lng"]);
        const name = row["Name of the Organisation"] || row["Address"];
        if (!isNaN(lat) && !isNaN(lng)) {
          const marker = new google.maps.Marker({
            position: { lat, lng },
            map,
            title: name,
            icon: { url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png" }
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `<div style="
              font-size:18px;
              font-weight:700;
              font-family:'Inter', sans-serif;
              color:#1a1a1a;
              background: rgba(255,255,255,0.95);
              padding: 10px 15px;
              border-radius: 10px;
              box-shadow: 0 4px 12px rgba(0,0,0,0.2);
              text-align:center;
            ">${name}</div>`,
            disableAutoPan: true
          });

          marker.addListener("mouseover", () => infoWindow.open(map, marker));
          marker.addListener("mouseout", () => infoWindow.close());
        }
      });

      // Pie chart
      const orgCounts = {};
      data.forEach(row => {
        const type = row["Type of organisation"] || "Other";
        orgCounts[type] = (orgCounts[type] || 0) + 1;
      });

      new Chart(document.getElementById('orgPieChart').getContext('2d'), {
        type: 'pie',
        data: {
          labels: Object.keys(orgCounts),
          datasets: [{
            data: Object.values(orgCounts),
            backgroundColor: ['#007bff', '#00c6ff', '#ff7f50', '#ffc107', '#28a745', '#6f42c1'],
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            tooltip: { mode: 'index', intersect: false }
          }
        }
      });

      // Bar chart
      const viewerCounts = {};
      data.forEach(row => {
        const org = row["Name of the Organisation"] || row["Address"];
        const viewers = parseInt(row["Number of individuals who watched the video"]) || 0;
        viewerCounts[org] = viewers;
      });

      new Chart(document.getElementById('viewBarChart').getContext('2d'), {
        type: 'bar',
        data: {
          labels: Object.keys(viewerCounts),
          datasets: [{
            label: 'Viewers',
            data: Object.values(viewerCounts),
            backgroundColor: '#007bff',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: { backgroundColor: '#007bff', titleColor: '#fff', bodyColor: '#fff' }
          },
          scales: {
            x: { ticks: { autoSkip: false, maxRotation: 90, minRotation: 45 }, grid: { display: false } },
            y: { beginAtZero: true, grid: { color: '#e0e0e0' } }
          }
        }
      });
    }

    window.onload = initMap;
  </script>
</body>
</html>
