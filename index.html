<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Video Reach Tracker</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background: #f8f9fc;
      margin: 0;
      padding: 0;
      text-align: center;
      color: #222;
      overflow-x: hidden;
    }

    header {
      background: linear-gradient(120deg, #007bff, #00c6ff);
      color: white;
      padding: 40px 20px 60px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: relative;
      opacity: 0;
      animation: fadeInDown 1s forwards;
    }

    h1 {
      margin: 0;
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    #subText {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-top: 10px;
    }

    #counters {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      display: inline-block;
      margin-top: -30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      opacity: 0;
    }

    #map {
      height: 70vh;
      width: 80%;
      margin: 40px auto;
      border-radius: 15px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      opacity: 0;
    }

    #schoolName {
      font-size: 1.2rem;
      color: #333;
      margin-bottom: 30px;
      opacity: 0;
    }

    /* Pulsing marker animation */
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.15); opacity: 0.6; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Fade in animations */
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBaKGAaZgEGYbQcIJidMnc9IJzLfM-TySY"></script>
</head>
<body>
  <header>
    <h1>üåç Live Data Tracking for Video Reach</h1>
    <div id="subText">Tracking real-time impact of the video across schools</div>
  </header>

  <div id="counters">Schools: 0 | Students: 0</div>
  <div id="map"></div>
  <div id="schoolName">Hover over a pin to see the school name</div>

  <script>
    async function initMap() {
      const response = await fetch("https://script.google.com/macros/s/AKfycbyYl4oN0kkSRwnBz9kVt1QZh_LUoil-8kpcVdRWZoMaAPWUzpqgv7QnNewBIxoY2cFuZQ/exec");
      const data = await response.json();


      // Initialize map zoomed on Asia
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 4,
        center: { lat: 23.5, lng: 80 },
        minZoom: 2,
        maxZoom: 8,
        styles: [
          { featureType: "poi", stylers: [{ visibility: "off" }] },
          { featureType: "road", stylers: [{ visibility: "simplified" }] },
        ]
      });

      // Fade-in animations
      document.getElementById("counters").style.animation = "fadeInUp 1s forwards";
      document.getElementById("map").style.animation = "fadeInUp 1.2s forwards";
      document.getElementById("schoolName").style.animation = "fadeInUp 1.4s forwards";

      // Calculate totals
      const totalSchools = data.length;
      let totalStudents = 0;
      data.forEach(row => {
        const students = parseInt(row["Number of Students watching the video"]) || 0;
        totalStudents += students;
      });

      // Animate counters
      const countersEl = document.getElementById("counters");
      let displaySchools = 0;
      let displayStudents = 0;
      const steps = 60;
      let frame = 0;
      const counterAnim = setInterval(() => {
        frame++;
        displaySchools = Math.floor((totalSchools / steps) * frame);
        displayStudents = Math.floor((totalStudents / steps) * frame);
        countersEl.textContent = `üè´ Schools: ${displaySchools} | üë©‚Äçüéì Students: ${displayStudents}`;
        if (frame >= steps) {
          countersEl.textContent = `üè´ Schools: ${totalSchools} | üë©‚Äçüéì Students: ${totalStudents}`;
          clearInterval(counterAnim);
        }
      }, 25);

      // Add markers
// Add markers
data.forEach(row => {
  const lat = parseFloat(row["lat"]);
  const lng = parseFloat(row["lng"]);
  const name = row["School Name"] || row["Address"];

  if (!isNaN(lat) && !isNaN(lng)) {
    const marker = new google.maps.Marker({
      position: { lat, lng },
      map,
      title: name,
      icon: { url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png" }
    });

    // Custom styled hover popup
    const infoWindow = new google.maps.InfoWindow({
      content: `<div style="
        font-size:18px;
        font-weight:700;
        font-family:'Inter', sans-serif;
        color:#1a1a1a;
        background: rgba(255,255,255,0.95);
        padding: 10px 15px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        text-align:center;
      ">${name}</div>`,
      disableAutoPan: true
    });

    // Hover to show popup, hide when mouse leaves
    marker.addListener("mouseover", () => infoWindow.open(map, marker));
    marker.addListener("mouseout", () => infoWindow.close());
  }
});


    }

    window.onload = initMap;
  </script>
</body>
</html>
